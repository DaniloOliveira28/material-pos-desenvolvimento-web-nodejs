<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.1/cropper.css" />
    </head>
    <body>
        <p id="form">
            Selecione a imagem desejada:
            <input type="file" onchange="onFileChange(event)">
        </p>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.1/cropper.js"></script>
        <script>

            function onFileChange(event) {
                const file = event.target.files[0];

                const reader = new FileReader();
                reader.onload = () => {
                    const el = document.getElementById('form');

                    const img = document.createElement('img');
                    img.style.width = '250px';
                    img.src = reader.result;

                    el.innerHTML = '';
                    el.appendChild(img);

                    const cropper = new Cropper(img, {});

                    const button = document.createElement('button');
                    button.onclick = () => {

                        const data = new FormData();
                        data.append('imagem', file);

                        const crop = cropper.getData();
                        data.append('cropx', crop.x);
                        data.append('cropy', crop.y);
                        data.append('cropwidth', crop.width);
                        data.append('cropheight', crop.height);

                        fetch('/upload', {
                            method: 'POST',
                            body: data
                        }).then(resp => {
                            if (resp.status == 200) {
                                el.innerText = 'Sucesso!';
                            } else {
                                el.innerText = 'Erro!';
                            }
                        }).catch(err => {
                            console.error(err);
                            el.innerText = 'Erro!';
                        });

                    };
                    button.innerText = 'Confirmar';
                    el.append(button);

                };
                reader.readAsDataURL(file);

            }

        </script>
    </body>
</html>
